<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicción de Fraude</title>
    <script src="logistic.js"></script>
</head>

<body>
    <h2>Predicción con Modelo de Regresión Logística</h2>
    <form id="predictionForm">

        <label for="type">Tipo de Transacción:</label><br>
        <select id="type" required>
            <option value="">Seleccione una opción</option>
            <option value="CASH-IN">CASH-IN</option>
            <option value="CASH-OUT">CASH-OUT</option>
            <option value="DEBIT">DEBIT</option>
            <option value="PAYMENT">PAYMENT</option>
            <option value="TRANSFER">TRANSFER</option>
        </select>
        <br><br>

        <label for="amount">Monto (Amount):</label><br>
        <input type="number" id="amount" step="0.01" required><br><br>

        <label for="oldbalanceOrg">Saldo antes (Old Balance Origin):</label><br>
        <input type="number" id="oldbalanceOrg" step="0.01" required><br><br>

        <label for="newbalanceOrig">Nuevo saldo (New Balance Origin):</label><br>
        <input type="number" id="newbalanceOrig" step="0.01" required><br><br>

        <label for="oldbalanceDest">Saldo Destino antes (Old Balance Dest):</label><br>
        <input type="number" id="oldbalanceDest" step="0.01" required><br><br>

        <label for="newbalanceDest">Nuevo Saldo Destino (New Balance Dest):</label><br>
        <input type="number" id="newbalanceDest" step="0.01" required><br><br>

        <label for="isFlaggedFraud">¿Marcado como Fraude?:</label><br>
        <select id="isFlaggedFraud" required>
            <option value="">Seleccione una opción</option>
            <option value="SI">SI</option>
            <option value="NO">NO</option>
        </select>
        <br><br>

        <button type="button" onclick="prediccion()">Hacer Predicción</button>
    </form>

    <h3>Resultado:</h3>
    <pre id="result"></pre>

    <script>
        function predict(input, model) {
            const intercept = model.intercept_[0];
            const coef = model.coef_[0].map(value => parseFloat(value));
            console.log(coef)

            let linearSum = intercept;

            // Convertir todos los elementos de input a números y validar
            for (let i = 0; i < input.length; i++) {
                const value = parseFloat(input[i]);

                // Realizar el cálculo
                linearSum += value * coef[i];
            }

            console.log("Suma lineal después de la conversión:", linearSum);

            // Aplicar la función sigmoide para calcular la probabilidad
            const probability = 1 / (1 + Math.exp(-linearSum));
            const prediction = probability >= 0.5 ? 1 : 0;

            return { probability, prediction };
        }

        async function prediccion() {
            const input = [
                1, 100, 100, 100,
                100, 100, 1
            ];

            try {
                const model = logistic;
                const { probability, prediction } = predict(input, model);

                document.getElementById('result').innerText =
                    `Probabilidad de Fraude: ${probability.toFixed(4)}\n` +
                    `Predicción: ${prediction ? 'Fraude' : 'No Fraude'}`;
            } catch (error) {
                document.getElementById('result').innerText =
                    "Ocurrió un error al hacer la predicción: " + error.message;
            }
        }
    </script>


</body>

</html>